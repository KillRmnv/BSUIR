# Модель милиции

# 1. Основные классы

### Police
**Описание**: Машина состояний отражающая поведение милиции.
- **Состояния**:
    - `ControleCentreState` – состояние обращения в центр управления
    - `EnforcementDepartmentState` –состояние обращения в отдел исполнения
    - `HRDepartmentState` – состояние обращения в отдел кадров
    - `InitialState` – инициализирующее состояние машины.
    - `InvestigationDepartmentState` – состояние обращения в отдел расследований.
    - `NewCaseState` – состояние обрабатывающее возникновение нового дела.
    - `NewEnforcementDepartmentCaseState` – состояние добавления расследованного дела в отднл исполнения
    - `PoliceManDeathState` – состояние обработки смерти полицейского.
    - `PublicSafetyDepartmentState`- состояние обращения в отдел по общественной безопасности

### State (абстрактный класс)
**Описание**: Интерфейс для всех состояний системы.
- **Методы**:
    - `run(Context context)` – обработка действий в текущем состоянии.
    - `-next(Context context)`- выбор следующего состояния

### Context
**Описание**: Базовый интерфейс для всех контекстов системы (как главного полицейского управления, так и отдельных департаментов).

**Методы**:
- `setInput(Input input)` – устанавливает систему ввода для контекста *(default реализация пустая)*
- `getInput(): Input` – возвращает текущую систему ввода *(default реализация возвращает null)*
- `getNextState(): State` – возвращает следующее состояние системы **(абстрактный метод)**
- `getTransfer(): TransferData` – возвращает объект для передачи данных между состояниями *(default реализация возвращает null)*

# 2. Подразделения полиции

### ControlCentre
**Описание**: Машина состояний отражающая поведение центра управления.
- **Состояния**:
    - `ReceiveCallState` – приём входящих вызовов.
    - `ChooseLawState` – выбор подходящего закона.
    - `DeleteSuspectState` – удаление подозреваемого из источника информации.
    - `DescribingAgeState` – описание возраста подозреваемого.
    - `DescribingHairColorState` – описание цвета волос.
    - `DescribingHeightState` – описание роста.
    - `DescribingWeightState` – описание веса.
    - `ManipulatingSuspectSourceState` – управление источниками информации.

### EnforcementDepartment
**Описание**:Машина состояний отражающая поведение исполнительного отдела.
- **Состояния**:
    - `CatchingSuspectState` – задержание подозреваемого.

### HRDepartment
**Описание**: Машина состояний отражающая поведение отдела кадров.
- **Состояния**:
    - `HirePoliceManState` – найм сотрудника.
    - `FirePoliceManState` – увольнение сотрудника.

### InvestigationDepartment
**Описание**:Машина состояний отражающая поведение следственного отдела.
- **Состояния**:
    - `ChooseCaseState` – выбор дела для расследования.
    - `InterviewingWitnessesState` – опрос свидетелей.

### PublicSafetyDepartment
**Описание**:Машина состояний отражающая поведение отдела общественной безопасности.
- **Состояния**:
    - `AreasPatrolState` – патрулирование районов.
    - `SchoolCampaigningState` – профилактика в школах.

# 3. Вспомогательные классы

## Класс Case (Уголовное дело)

**Назначение**: Хранит информацию об уголовном деле

**Состав**:
- contacts: List<String> - список контактов по делу
- suspects: List<Suspect> - список подозреваемых
- law: Law - нарушенный закон
- type: Integer - тип дела
- commonTraits: Traits - общие характеристики преступления

**Основные методы**:
- empty() - проверяет пустое ли дело
- generateRandomContacts() - генерирует случайные контакты
- generateSimplePhone() - создает случайный номер телефона

## Класс Human (Человек)

**Назначение**: Базовый класс для всех персонажей системы

**Состав**:
- name: String - имя
- secondName: String - фамилия
- thirdName: String - отчество
- traits: Traits - физические характеристики

**Основные методы**:
- getFullName() - возвращает полное ФИО
- generateRandomName() - генерирует случайное имя

**Константы**:
- FIRST_NAMES - список имен
- LAST_NAMES - список фамилий
- PATRONYMICS - список отчеств

## Класс Law (Закон)

**Назначение**: Описывает правовую норму

**Состав**:
- id: int - идентификатор закона
- description: String - описание закона
- punishment: String - предусмотренное наказание

**Методы**:
- Геттеры для всех полей


## Класс PoliceMan (Полицейский)

**Назначение**: Представляет сотрудника полиции

**Состав**:
- id: int - идентификатор сотрудника
- experience: int - опыт работы (в годах)
- salary: int - текущая зарплата
- Наследует все поля класса Human (ФИО, характеристики)

**Основные методы**:
- generateRandomExperience() - генерирует случайный опыт работы
- calculateSalary() - рассчитывает зарплату на основе опыта
- gainExperience() - увеличивает опыт и пересчитывает зарплату
- Info() - возвращает информацию о сотруднике

## Класс Suspect (Подозреваемый)

**Назначение**: Представляет подозреваемого в преступлении

**Состав**:
- intellegence: int - уровень интеллекта (70-160)
- Наследует все поля класса Human (ФИО, характеристики)

**Основные методы**:
- generateBiasedIntellegence() - генерирует уровень интеллекта
- Info() - возвращает полную информацию о подозреваемом

## Класс Traits (Характеристики)

**Назначение**: Описывает физические характеристики человека

**Состав**:
- hairColor: String - цвет волос
- height: int - рост (см)
- age: int - возраст
- weight: int - вес (кг)

**Константы**:
- HAIR_COLORS - возможные цвета волос

**Особенности**:
- Конструктор с параметром Boolean для генерации случайных значений
- Конструктор копирования

## Класс LawRegistry (Реестр законов)

**Назначение**: Хранит и управляет базой законов

**Состав**:
- CRIMINAL_LAWS: HashMap<Integer, Law> - уголовные законы
- ADMIN_LAWS: HashMap<Integer, Law> - административные законы

**Основные методы**:
- printCriminalLaws() - выводит список уголовных законов
- printAdminLaws() - выводит список административных законов

**Содержимое реестра**:
1. Уголовные законы (10 статей):
  - Убийство, кража, мошенничество и др.
  - Наказания: от штрафов до лишения свободы

2. Административные законы (10 статей):
  - Нарушения ПДД, мелкое хулиганство, распитие алкоголя
  - Наказания: штрафы, арест до 15 суток

## Класс SuspectSource (Источник информации о подозреваемых)

**Назначение**: Управляет базой данных подозреваемых

**Состав**:
- suspects: Map<String, Suspect> - подозреваемые по ФИО
- suspectTraits: Map<String, Map<Integer, Set<String>>> - индексы характеристик

**Основные методы**:
- addSuspect() - добавляет подозреваемого
- deleteSuspect() - удаляет подозреваемого
- findSuspectsBasedOnCommonTraits() - ищет по характеристикам
- traitNumHair()/traitStringHair() - конвертирует цвет волос

**Особенности работы**:
1. Хранит подозреваемых в 4 индексах:
  - По цвету волос
  - По возрасту (с шагом 10 лет)
  - По весу (с шагом 10 кг)
  - По росту (с шагом 10 см)

2. Поиск учитывает:
  - Совпадения по характеристикам
  - Количество совпавших параметров
  - Возвращает наиболее вероятных подозреваемых
## TransferData
**Назначение**: Передача данных между различными состояниями и контекстами системы

**Состав полей**:
- `caseData: Case` - объект уголовного дела
- `suspectData: Suspect` - данные подозреваемого
- `policeManData: PoliceMan` - информация о сотруднике полиции
- `traits: Traits` - физические характеристики

**Конструктор**:
- Инициализирует все поля пустыми объектами соответствующих типов

**Особенности использования**:
1. **Передача комплексных данных** между состояниями системы
2. **Сохранение целостности** связанных данных
3. **Упрощение взаимодействия** между различными модулями

# 4. Система ввода/вывода

## Интерфейс Input

**Назначение**: Определяет контракт для работы с вводом-выводом

**Методы**:
- `getChoice()` - получение числового выбора пользователя
- `getString()` - получение строки от пользователя
- `show()` - вывод сообщения
- `getNumberRange()` - получение диапазона чисел
- `getRegex()` - ввод с проверкой по регулярному выражению
- `getChoiceFromMap()` - выбор из элементов Map
- `handleQTE()` - обработка быстрых событий (Quick Time Event)
- `getLine()` - чтение строки с очисткой буфера

## Класс ConsoleInput

**Назначение**: Реализация ввода/вывода через консоль

**Основные методы**:

### Ввод данных
- `getChoice()` - защищенный ввод числа в заданном диапазоне
- `getString()` - ввод строки
- `getNumberRange()` - ввод диапазона чисел (формат "X-Y")
- `getRegex()` - ввод с валидацией по regex
- `getLine()` - чтение строки с предварительной очисткой буфера

### Вывод данных
- `show()` - вывод сообщения
- `showNumericRange()` - вывод диапазона чисел
- `show(List<String>)` - вывод списка строк

### Специальные функции
- `clearBuffer()` - очистка буфера ввода
- `handleQTE()` - обработка быстрого нажатия (2000 мс таймаут)

**Особенности**:
- Защита от некорректного ввода
- Поддержка вывода структурированных данных
- Рефлексия для работы с Map в getChoiceFromMap()
- Многократное использование в разных состояниях системы

# 5. Сериализация данных

## класс JacksonSerializer
**Назначение**: Обеспечивает сериализацию и десериализацию объектов системы в JSON-формат

## Основные возможности

### Базовые методы работы с JSON
- `serialize(Object)` - преобразует объект в JSON-строку
- `deserialize(String, Class<T>)` - восстанавливает объект из JSON
- `saveToFile(Object, String)` - сохраняет объект в JSON-файл
- `loadFromFile(String, Class<T>)` - загружает объект из JSON-файла

### Инициализация системы
- `load()` - комплексная загрузка или создание всех контекстов системы:
  - Создает тестовые данные (30 подозреваемых, 5 полицейских)
  - Загружает или инициализирует контексты всех подразделений
  - Возвращает полностью настроенный PoliceContext

# 6. Управление состояниями

## StateMachine
**Назначение**: Управление жизненным циклом и переходами между состояниями системы

## Основные характеристики

### Состояния
- `currentState` - текущее активное состояние (не сериализуется)
- `currentStateClassName` - имя класса текущего состояния (для сериализации)
- `context` - контекст выполнения, связанный с машиной состояний

### Функциональность
- Последовательное выполнение цепочки состояний
- Сохранение/восстановление состояния системы
- Автоматическое управление переходами между состояниями

## Ключевые методы

### Управление выполнением
- `runAll(State)` - запускает выполнение цепочки состояний